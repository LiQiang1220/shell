ec.pkg("ec.shoppingCart.prefer");var preferentialMap={};ec.shoppingCart.prefer.selectSbomCodes=function(b,a){};globalPreferential=undefined;ec.shoppingCart.prefer.syncproductList=function(a){$.ajax({url:"/order/shoppingCart/preferential.json?sbomCode="+a,type:"get",timeout:10000,async:false,success:function(b){if(!b.success||$.isEmptyObject(b.productList)||!b.productList||b.productList.length==0){return}globalPreferential=b.productList},error:function(b){}})};ec.shoppingCart.prefer.productList=function(b,a){$.ajax({url:domainMain+"/order/shoppingCart/preferential.json?sbomCode="+b,type:"get",dataType:"jsonp",timeout:10000,success:function(c){if(!c.success||$.isEmptyObject(c.productList)||!c.productList||c.productList.length==0){return}$.each(c.productList,function(r,s){$("#preferential-"+r).html("");var n=[];var o=s.length;var t=0;var d=0;for(var m=0;m<o;m++){var q=s[m].prefereBuyPrdList;var p=s[m].mainSBOMCode;if(q!=null&&$.trim(q)!=""&&q!=undefined){var g=q.length;d=g;for(var l=0;l<g;l++){var k=q[l];var h=p+"_"+k.sbomId;var f="";if(preferentialMap[h]&&preferentialMap[h]!=null){f="hide";t=t+1}var e=domainMain+"/product/"+k.disPrdId+".html#"+k.sbomId;n.push('<li id="selling-recommand-'+p+"-"+k.sbomId+'" class="'+f+'">');n.push('	<a  target="_blank" href="'+e+'">');n.push('		<img src="'+ec.mediaPath+k.photoPath+"78_78_"+k.photoName+'">');n.push("	</a>");n.push('<div class="discount-detail">');n.push('	<a  target="_blank" href="'+e+'" class="discount-name" title="'+ec.util.escapeHtml(k.prdName)+'">'+ec.util.escapeHtml(k.prdName)+"</a>");n.push('	<div class="discount-info clearfix">');n.push('		<div class="discount-price">');n.push("			<span>&yen;&nbsp;"+k.preferePriceStr+"</span>");n.push("			<s>&yen;&nbsp;"+k.oriPriceStr+"</s>");n.push("		</div>");n.push('		<a href="javascript:;" data-qty="1" data-type="20" needResultset="true" mainSbomCode="'+p+'" maincode="'+a[s[m].mainSBOMCode]+'" data-id="'+k.sbomId+'" onclick="ec.shoppingCart.addCartItem($(this),true);return false;" class="discount-btn"></a>');n.push("	</div>");n.push("</div>");n.push("</li>")}}}$("#preferential-"+r).html(n.join(""));if(t<d&&n.join("").length>0){$("#preferential-"+r).parent().parent().show()}})},error:function(c){}})};ec.shoppingCart.prefer.preferProductFromCart=function(c){var b=c.itemList;preferentialMap={};for(var e=0;e<b.length;e++){var f=b[e];var g=f.sbomCode;if(f.preferSkuList&&f.preferSkuList.length>0){for(var d=0;d<f.preferSkuList.length;d++){var h=f.preferSkuList[d];var a=g+"_"+h.skuId;preferentialMap[a]=h}}}};ec.shoppingCart.prefer.hideProduct=function(d){var b=(d).attr("data-type");if(b=="20"){var c=(d).attr("data-id");var a=(d).attr("mainSbomCode");$("#selling-recommand-"+a+"\uff0d"+c).hide()}};ec.shoppingCart.prefer.showProduct=function(b,e){for(var d=0;d<b.length;d++){var a=e[d];if(a=="20"){var c=b[d];preferentialMap[c]=null}}};
