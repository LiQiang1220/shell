ec.pkg("ec.shoppingCart");ec.load("ajax",{loadType:"lazy"});ec.load("ec.box");chooseResult={};ec.shoppingCart.updateChooseRsult=function(b,a){if(chooseResult[b]){return}chooseResult[b]=a};ec.shoppingCart.initChooseRsult=function(b){chooseResult={};var a=b.itemList;for(var c=0;c<a.length;c++){var d=a[c];if(d.invalidCauseReason==0){if(d.isBundle=="0"){chooseResult[d.bundleId]=true}else{chooseResult[d.skuId]=true}}}};ec.shoppingCart.refresh=function(a){if(ec.shoppingCart.initCartTable(a)){ec.shoppingCart.coupon.loadCoupon()}};ec.shoppingCart.checkToOrder=function(){var a=$("#cart-list i.icon-choose[name='skuIds']");var f=$("#cart-list i.icon-choose[name='bundleIds']");var b=[];a.each(function(){var j=$(this).parent();var h=$(this).attr("value");var r=$("#quantity-"+h,j).val();var n=$("#quantity-"+h,j).attr("data-type");var o={};var q={};var p={};var i=$('div[name="extendIds"]',j).attr("skuid");if(i){q.itemId=i;q.qty=r;q.itemType="S1";q.mainItemid=h;b.push(q)}var l=$('div[name="accidentIds"]',j).attr("skuid");if(l){p.itemId=l;p.qty=r;p.itemType="S6";p.mainItemid=h;b.push(p)}if(r){o.itemId=h;o.qty=r;if(n=="1"){o.itemType="S0"}if(n=="8"){o.itemType="S0";o.itemProp={Internal_Purchase:"true"}}if(n=="2"){o.itemType="B"}if(n=="9"){o.itemType="B";o.itemProp={Internal_Purchase:"true"}}var k=$('input[name="giftId"]',j);if(k.length>0){var g=[];k.each(function(){if($(this).attr("giftId")){var s={sbomCode:$(this).attr("giftId")};g.push(s)}});o.gifts=g}var m=$('input[name="preferId"]',j);if(m.length>0){m.each(function(){var s={};if($(this).attr("preferId")){s.itemId=$(this).attr("preferId");s.qty="1";s.itemType="20";s.mainItemid=h;b.push(s)}})}b.push(o)}});f.each(function(){var g=$(this).parent();var k=$(this).attr("value");var j=$("#quantity-bundle-"+k,g).val();var h=$("#quantity-bundle-"+k,g).attr("data-type");var i={};if(j){i.itemId=k;i.qty=j;if(h=="2"){i.itemType="B"}if(h=="9"){i.itemType="B";i.itemProp={Internal_Purchase:"true"}}b.push(i)}});if(b.length==0){$("#totalNumber").html("0");$("#sc-cartInfo-totalOriginalPrice").html("&yen;&nbsp;0.00");$("#sc-cartInfo-minusPrice").html("&yen;&nbsp;0.00");$("#sc-cartInfo-totalPrice").html("&yen;&nbsp;0.00");return}var e=ec.lang.json.stringify(b);var c=ec.minicart.convertToCart(b);var d={};$.extend(d,c);d.salePortal=1;d.saleChannel=1001;$.ajax({url:domainCart+"/newcart/shoppingCart.json?t="+new Date().getTime(),dataType:"jsonp",timeout:10000,traditional:true,data:d,success:function(q){if(q.retcode!="0"){ec.shoppingCart.selling.initRecommend();ec.shoppingCart.hideProductList();return}var l=q.cartInfo.cartVO,m=l.itemList;for(var k=0;k<m.length;k++){var p=m[k];if(p.isBundle=="0"){product=p;var h=$("#order-pro-"+product.skuId);$("#p-price-total-"+product.skuId,h).html("<span>&yen;&nbsp;"+product.subtotal.toFixed(2)+"</span>");if(product.normalPrice!=product.salePrice){$("#p-price-total-"+product.skuId,h).append('<span class="p-price-save">&yen;&nbsp; '+product.totalDiscountPrice.toFixed(2)+"</span>")}if(product.extendAccidentList){for(var g=0;g<product.extendAccidentList.length;g++){var n=product.extendAccidentList[g];$("#p-price-total-"+n.skuId,h).html("&yen;&nbsp;"+n.subtotal.toFixed(2))}}}else{if(p.isBundle=="1"){var o=p;$("#order-pro-bundle-"+o.bundleId).find(".p-price-total").html("&yen;&nbsp;"+(o.totalBundlePrice).toFixed(2));if(o.totalDiscountPrice>0){$("#order-pro-bundle-"+o.bundleId).find(".p-price-total").append('<span class="p-price-save">&yen;&nbsp;'+o.totalDiscountPrice.toFixed(2)+"</span>")}}}}$("#totalNumber").html(l.miniTotalNumber);$("#sc-cartInfo-totalOriginalPrice").html("&yen;&nbsp;"+l.miniTotalPrice.toFixed(2));$("#sc-cartInfo-minusPrice").html("&yen;&nbsp;"+l.preferentialPrice.toFixed(2));$("#sc-cartInfo-totalPrice").html("&yen;&nbsp;"+l.miniTotalPrice.toFixed(2))},error:function(){}})};ec.shoppingCart.convertToCart=function(e){var h=[],d=[],f=[],j=[],g=[],a=[];for(var c=0;c<e.length;c++){orderItem=e[c];h.push(orderItem.itemId);d.push(orderItem.itemType);f.push(orderItem.qty);a.push(orderItem.operation)}var b={};b.sbs=h.join(",");b.types=d.join(",");b.qtys=f.join(",");b.ops=a.join(",");b.saleChannel=1001;b.salePortal=1;return b};ec.shoppingCart.updateCheckStatus=function(a){new ec.ajax().get({url:domainCart+"/newcart/update.json",dataType:"jsonp",data:ec.shoppingCart.convertToCart(a),timeout:10000,timeoutFunction:function(){ec.ui.loading.hide();ec.shoppingCart._faultTolerant(skuId,type,num)},errorFunction:function(){ec.ui.loading.hide()},successFunction:function(c){if("0"!=c.retcode){ec.ui.loading.hide();ec.showError(c);return}ec.ui.loading.hide();var b=c.cartInfo.cartVO;var d=new Array();ec.shoppingCart.refresh(b)}})};ec.shoppingCart.check=function(f){var d=$(f).closest("div"),b=5;if($(f).hasClass("icon-choose-disabled")){return}if(!$(f).hasClass("icon-choose")){$(f).addClass("icon-choose");var a=true;b=5;$("#cart-list i.icon-choose-normal").each(function(g){if(!$(this).hasClass("icon-choose")&&!$(this).hasClass("icon-choose-disabled")){a=false}});if(a){$(".icon-choose-all").addClass("icon-choose");ec.shoppingCart.prefer.selectSbomCodes(f,true);ec.shoppingCart.recommend.selectSbomIds("",true)}else{ec.shoppingCart.prefer.selectSbomCodes(f,false);ec.shoppingCart.recommend.selectSbomIds("",false)}}else{$(f).removeClass("icon-choose");$(".icon-choose-all").removeClass("icon-choose");b=6}var c=[],e={itemId:$(f).attr("value"),itemType:$(f).attr("data-type"),qty:1,operation:b};c.push(e);ec.shoppingCart.updateCheckStatus(c)};ec.shoppingCart.selectAll=function(f,e,a){var b=[];for(var d=0;d<e.length;d++){var g={};g.itemId=e[d].id;g.qty=1;g.itemType=e[d].type;g.operation=f;b.push(g)}for(var c=0;c<a.length;c++){var g={};g.itemId=a[c].id;g.qty=1;g.itemType=a[c].type;g.operation=f;b.push(g)}if(b.length==0){$("#totalNumber").html("0");$("#sc-cartInfo-totalOriginalPrice").html("&yen;&nbsp;0.00");$("#sc-cartInfo-minusPrice").html("&yen;&nbsp;0.00");$("#sc-cartInfo-totalPrice").html("&yen;&nbsp;0.00");return}ec.shoppingCart.updateCheckStatus(b)};ec.shoppingCart.checkAll=function(c){var b=[],a=[];if($(c).hasClass("icon-choose")){$("#cart-list i.icon-choose-normal").each(function(){if(!$(this).hasClass("icon-choose-disabled")){$(this).addClass("icon-choose")}var d={id:$(this).attr("value"),type:$(this).attr("data-type")};if($(this).attr("name")=="skuIds"){b.push(d)}else{if($(this).attr("name")=="bundleIds"){a.push(d)}}});ec.shoppingCart.prefer.selectSbomCodes(c,true);ec.shoppingCart.selectAll(5,b,a)}else{$("#cart-list i.icon-choose-normal").each(function(){if(!$(this).hasClass("icon-choose-disabled")){$(this).removeClass("icon-choose")}var d={id:$(this).attr("value"),type:$(this).attr("data-type")};if($(this).attr("name")=="skuIds"){b.push(d)}else{if($(this).attr("name")=="bundleIds"){a.push(d)}}});ec.shoppingCart.selectAll(6,b,a)}};ec.shoppingCart.confirm=function(){_paq.push(["trackLink","\u8d2d\u7269\u8f66-\u53bb\u7ed3\u7b97","link"," "]);ec.code.addAnalytics({hicloud:true});var a=$("#cart-list i.icon-choose[name='skuIds']");var c=$("#cart-list i.icon-choose[name='bundleIds']");if(a.length==0&&c.length==0){var b=[];b.push('<div class="box-content" style="height: auto;">');b.push('    <div class="box-prompt01-error">');b.push('<div class="h">');b.push("     <i></i>");b.push("</div>");b.push('<div class="b">');b.push('   <p id="success-message">\u60a8\u8fd8\u6ca1\u6709\u9009\u62e9\u5546\u54c1\u54df</p>');b.push(" </div>");b.push("</div>");b.push('<div class="box-button">');b.push(' <a href="javascript:;" class="box-ok"><span>\u786e\u5b9a</span></a>');b.push("</div>");b.push("</div>");new ec.box(b.join(" "),{boxid:"address_null_tips",boxclass:"ol_box_4",width:600,height:230,title:"",showButton:false,onopen:function(d){d.setPosition()},onclose:function(){$(".button-submit-order").removeClass("button-style-disabled-4").addClass("button-style-1")}}).open();return}ec.binding.cart.withPhone(function(){ec.cart.jumpToConfirm(a,c)})};ec.ui.cartNumer=function(a,b){var c={max:null,min:null,showButton:true,minusBtn:'<a id="pro-quantity-minus" href="javascript:;">&minus;</a>',plusBtn:'<a id="pro-quantity-plus" href="javascript:;">&#43;</a>'},d=$(a),b=$.extend(c,b),e=function(f){var h=f.which,g=parseInt(this.value,10),i=(g<1)?1:g;if((h<37||h>40)&&h!=8&&h!=46){if(i>b.max||i<b.min){f.preventDefault();return false}else{if((h<48||h>57)&&(h<96||h>105)&&h!=9){f.preventDefault();return false}}}};d.each(function(){var g=$.extend({},b),j=$(this).css("ime-mode","disabled");var n=j.attr("max");if(n){b.max=g.max=parseInt(n,10)||g.max}n=j.attr("min");if(n){b.min=g.min=parseInt(n,10)||g.min}var p=ec.shoppingCart.getlimit(parseInt(j.attr("sbomlimit")),parseInt(j.attr("productlimit")));if(g.showButton){var h=$(g.minusBtn).click(function(){var i=j.val()||0,s=parseInt(i,10)-1;if(typeof(g.min)=="number"&&s<g.min){return}j.val(s).trigger("blur")}),q=$(g.plusBtn).click(function(){var i=j.val()||0,s=parseInt(i,10)+1;if(typeof(g.max)=="number"&&s>g.max){return}j.val(s).trigger("blur")});var r=j.next().append(q).append(h);j.after(r);if(this.value<=1){h.removeClass().addClass("disabled")}else{h.removeClass()}var k=j.attr("limitSku");if($.trim(k).length>0){var f=k.split(",");for(var m=0;m<f.length;m++){var o=f[m].split(":");if(this.value==parseInt(o[1])){q.addClass("disabled");ec.shoppingCart.limitTip(q,p)}}}var l=j.attr("invalidReason");if(l=="7"||l=="8"){q.addClass("disabled");ec.shoppingCart.limitTip(q,p)}if(j.attr("limit")=="1"){q.addClass("disabled");ec.shoppingCart.limitTip(q,p)}}j.data("ovalue",j.val()||0).keydown(e).keyup(function(){var i=parseInt(this.value||0);if(typeof(g.min)=="number"&&i<g.min){this.value=g.min;return}else{if(typeof(g.max)=="number"&&i>g.max){this.value=g.max;return}}}).blur(function(){if(this.value<=1){h.removeClass().addClass("disabled")}else{h.removeClass()}if(typeof g.onchange==="function"){var E=j.data("ovalue"),u=this.value||0,D=parseInt(u,10)-parseInt(E,10),y=j.attr("invalidReason"),v=j.attr("invalidReason"),w=j.attr("sbomLimit"),A=j.attr("productLimit"),C=j.attr("data-type");bundleId=j.attr("data-skuId");if(D==0){return}if(D>0){if(q.hasClass("disabled")){j.attr("value",E);j.data("ovalue",E);if(E==1){h.addClass("disabled")}return}if(C=="2"||C=="9"){var x=j.attr("limitSku");var t=j.attr("alreadyLimit");if($.trim(x).length>0){var s=x.split(",");for(var z=0;z<s.length;z++){var B=s[z].split(":");if(u==parseInt(B[1])){j.attr("value",u);q.addClass("disabled")}}}else{if($.trim(t).length>0){j.attr("value",E);j.data("ovalue",E);q.addClass("disabled");return}}}else{limit=A-w>0?(w==0?A:0):(A==0?w:0);if(D==1){if(limit>0){if(parseInt(limit)-u<=0){j.attr("value",u);j.data("ovalue",u);q.addClass("disabled")}}}}}j.data("ovalue",u);g.onchange.call(this,u,D)}})})};ec.shoppingCart._renderNum=function(){$("#p-stock-btn-area").html("");ec.ui.cartNumer("#cart-list input.p-stock-text",{max:999,min:1,minusBtn:'<a id="pro-quantity-minus" href="javascript:;">&minus;</a>',plusBtn:'<a id="pro-quantity-plus" href="javascript:;">&#43;</a>',onchange:function(e,b){var d=$(this),a=d.attr("data-skuId"),c=d.attr("data-type");ec.shoppingCart._updateNum(a,c,b)}})};ec.shoppingCart._checkUnderstockAndLimitstock=function(){var d=true;var c=function(g){return $(g).closest("table").find("input[type=checkbox]")};if($(".understock").length>0||$(".limitstock").length>0||$(".quotastock").length>0||$(".timerpromo").length){var f=$(".limitstock"),b=$(".understock"),a=$(".quotastock"),e=$(".timerpromo");if(f.length>0){f.each(function(g,h){if(c(h).attr("checked")){d=false;$("#tips-text-p").html("\u8d2d\u7269\u8f66\u5546\u54c1\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97");return false}})}else{if(b.length>0){b.each(function(g,h){if(c(h).attr("checked")){d=false;$("#tips-text-p").html("\u8d2d\u7269\u8f66\u6709\u5e93\u5b58\u4e0d\u8db3\u5546\u54c1\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97");return false}})}else{if(a.length>0){a.each(function(g,h){if(c(h).attr("checked")){d=false;$("#tips-text-p").html("\u5185\u8d2d\u5546\u54c1\u5df2\u8d85\u51fa\u8d2d\u4e70\u9650\u5236\u914d\u989d\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97");return false}})}else{if(e.length>0){e.each(function(g,h){if(c(h).attr("checked")){d=false;$("#tips-text-p").html("\u542b\u6709\u6d3b\u52a8\u672a\u5f00\u59cb\u6216\u8005\u5df2\u7ed3\u675f\u7684\u5546\u54c1\uff0c\u8bf7\u5904\u7406\u540e\u518d\u7ed3\u7b97");return false}})}}}}}if(d){$("#sc-action-tips").addClass("hide")}else{$("#sc-action-tips").removeClass("hide")}return d};ec.shoppingCart._faultTolerant=function(a,e,d){var b=null;if(e==2||e==9){b=$("#quantity-bundle-"+a)}else{b=$("#quantity-"+a)}var c=parseInt(b.val())-d;if(b!=null){b.data("ovalue",c);b.val(c);$("#cart-list li.forUpdateFailed-"+a).html("x"+c)}};ec.shoppingCart._renderInventory=function(a){$("report-errors").remove();var b=function(c,e,d){if(c&&c.length>0){$(e+c.join(","+e),"#cart-form").html(d).show()}};b(a.skuInventoryErrors,".sku-error-","\u8be5\u5546\u54c1\u6682\u65f6\u7f3a\u8d27");b(a.skuLimitErrors,".limitstock-","\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650");b(a.skuLimitErrors,".limitstock-","\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650");b(a.skuValidTimeErrors,".sku-error-","\u6d3b\u52a8\u672a\u5f00\u59cb\u6216\u5df2\u7ecf\u7ed3\u675f");b(a.skuInternalQuataErrors,".sku-error-","\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650");b(a.bundleInternalQuataErrors,".sku-error-","\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650")};ec.cart.productTypeOrderItemType=function(a,c){var b={};if(a==1){b.itemType="S0"}else{if(a==2){b.itemType="B"}else{if(a==6){b.itemType="S1";b.mainItemid=c}else{if(a==7){b.itemType="S6";b.mainItemid=c}else{if(a==8){b.itemType="S0";b.itemProp={Internal_Purchase:"true"}}else{if(a==9){b.itemType="B";b.itemProp={Internal_Purchase:"true"}}else{if(a==20){b.itemType="20";b.mainItemid=c}else{b.itemType="S0"}}}}}}}return b};ec.shoppingCart.delGift=function(f,d){if(!ec.ui.confirm(f,"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u8be5\u5546\u54c1\u5417\uff1f")){return}var b=[],c={},a=[];c.itemId=d;c.qty=0;c.operation=2;c.itemType="S0";if($(f).parent().parent().siblings("ul").length>0){$(f).parent().parent().siblings("ul").each(function(){if($(this).attr("skuid")){var g={};g.sbomCode=$(this).attr("skuid");a.push(g)}})}c.gifts=a;b.push(c);var e=ec.lang.json.stringify(b);new ec.ajax().get({url:domainCart+"/newcart/update.json",dataType:"jsonp",data:{cartjson:e,saleChannel:1001,salePortal:1},timeout:10000,timeoutFunction:function(){ec.ui.loading.hide();ec.shoppingCart._faultTolerant(skuId,type,num);alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},errorFunction:function(){ec.ui.loading.hide();ec.shoppingCart._faultTolerant(skuId,type,num)},successFunction:function(h){if("0"!=h.retcode){ec.ui.loading.hide();ec.shoppingCart._faultTolerant(skuId,type,num);ec.showError(h);return}ec.ui.loading.hide();var g=h.cartInfo.cartVO;var i=new Array();ec.shoppingCart.refresh(g)}})};ec.shoppingCart.del=function(b,a,l,o){var h=0;if(a==null){var m=$(".sc-pro-list i ");var j=m.length;for(var g=0;g<j;g++){var f=$(m[g]);if($(f).hasClass("icon-choose")){h++}}}if(!a&&h==0){alert("\u8bf7\u9009\u62e9\u60a8\u8981\u5220\u9664\u7684\u5546\u54c1\uff01");return}if(!ec.ui.confirm(b,a?"\u786e\u8ba4\u8981\u5220\u9664\u8be5\u5546\u54c1\u5417\uff1f":"\u786e\u8ba4\u8981\u5220\u9664\u52fe\u9009\u5546\u54c1\u5417\uff1f")){return}$("#pro-recommend-list").css({transform:"translate3d(0px, 0px, 0px)"});var e={};if(a){e=ec.cart.productTypeOrderItemType(l,o);e.itemId=a.toString();e.type=l.toString()}else{var n=[];var k=[];var l=[];var p=[];var m=$(".sc-pro-list i ");var j=m.length;for(var g=0;g<j;g++){var f=$(m[g]);if($(f).hasClass("icon-choose")){var d=$(f).attr("data-type");var c="";if(d==1){c="S0"}else{if(d==2){c="B"}else{if(d==6){c="S1"}else{if(d==7){c="S6"}else{if(d==8){c="S0"}else{if(d==9){c="B"}else{if(d==20){c="20"}else{c="S0"}}}}}}}k.push(c);l.push(d);n.push($(f).attr("value"))}}e.itemId=n.join(",");e.itemType=k.join(",");e.type=l.join(",")}ec.shoppingCart.del2Cart(e,function(A,q,w){var y=ec.util.cookie.get("cart-recover")||",",r=function(E,D,i){var C=y.indexOf(","+E+";");if(C==-1){if(y.split(";").length<1000){y+=E+";"+D+","}}else{var B=y.substring(C+E.toString().length+2,y.indexOf(",",C+1));D+=parseInt(B);y=y.replace(","+E+";"+B+",",","+E+";"+D+",")}},z=function(C,i){if(i=="2"||i=="9"){var B=parseInt($("#quantity-bundle-"+C).val(),10);$("#order-pro-bundle-"+C+" input[name=bundleSkuList]").each(function(){r($(this).attr("value"),B,i)})}else{if(i!="6"&&i!="7"&&i!="20"){var B=parseInt($("#quantity-"+C).val(),10);r(C,B,i)}}};if(q){z(q,w);var u=q.toString();ec.util.cookie.set(u,w,{id:q,type:w})}else{var x=$(".sc-pro-list i ");var v=x.length;for(var t=0;t<v;t++){var s=$(x[t]);if($(s).hasClass("icon-choose")){var q=$(s).attr("value");var w=$(s).attr("data-type");z(q,w);var u=q.toString();ec.util.cookie.set(u,w,{id:q,type:w})}}}ec.cart.setRecover(y);ec.shoppingCart.refreshRecover();ec.shoppingCart.getInfoFromCart()});resetToAccounts()};ec.shoppingCart.del2Cart=function(d,l){var b=d.itemId.split(",");var j=d.itemType.split(",");var f=d.type.split(",");var g=[];if(d.itemId.indexOf(",")!=-1){var h=b.length;for(var e=0;e<h;e++){var k={};k.itemId=b[e];k.itemType=j[e];if(f[e]=="8"||f[e]=="9"){k.itemProp={Internal_Purchase:"true"}}k.operation=3;g.push(k)}}else{var k={};var a=b[0];k.itemId=b[0];k.itemType=d.itemType;k.operation=3;if(d.itemType=="S1"||d.itemType=="S6"||d.itemType=="20"){k.mainItemid=d.mainItemid}if(d.type=="8"||d.type=="9"){k.itemProp={Internal_Purchase:"true"}}g.push(k)}var m=ec.lang.json.stringify(g);var c={data:{cartjson:m,saleChannel:1001,salePortal:1,needCartResult:1},dataType:"jsonp",timeout:10000,timeoutFunction:function(){ec.ui.loading.hide();alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},successFunction:function(i){ec.cart.changeAdded(i);if("0"!=i.retcode){ec.ui.loading.hide();ec.showError(i);return}if(l){ec.shoppingCart.showProductList();ec.shoppingCart.prefer.showProduct(b,j);l(i,a,f)}return}};c.url=domainCart+"/newcart/del.json";new ec.ajax().get(c);resetToAccounts();new Slider({objid:"#pro-recommend-goods",shownum:5,type:5}).init()};ec.cart.batchDel=function(a){$.ajax({url:domainCart+"/newcart/del.json?"+a,dataType:"jsonp",timeout:10000,traditional:true,success:function(b){ec.cart.changeAdded(b)},error:function(){}})};ec.cart.readd=function(a,g){var d=function(){ec.cart.removeSkuFromRecover(a,function(i){if(!i||i.length<3){$("#pro-delete-recover").hide()}})};if($("#box-"+a).length>0){ec.shoppingCart._updateNum(a,1,g);d();ec.shoppingCart.refreshRecover();$("#pro-recommend-area").empty()}else{var b=[];var f={};f.itemId=a;f.operation=1;var e=ec.util.cookie.get(a.toString());f.itemType="S0";f.qty=g;if(e=="8"||e=="9"){f.itemProp={Internal_Purchase:"true"}}b.push(f);var h=ec.lang.json.stringify(b);var c={cartjson:h,saleChannel:1001,salePortal:1,needResultset:1};ec.cart.add(c,{successFunction:function(i){d();$("#cart-form").remove();$("div.sc-pro-list").nextUntil("#cart-empty-msg").remove();$("#cart-empty-msg").hide();$("#pro-recommend-area").hide();ec.shoppingCart.getInfoFromCart();ec.shoppingCart.refreshRecover();ec.shoppingCart.showProductList()},errorFunction:function(i){alert(i.msg)}})}resetToAccounts()};ec.cart.slider={size:0,index:0,prev:function(a){if(this.index<=0||this.size<6){return}this.index--;$("#pro-recommend-list").animate({left:-193*this.index},1000);$("#cart-img-next").attr("class","pro-scroller-forward");if(this.index==0){$("#cart-img-prev").attr("class","pro-scroller-back-disabled")}},next:function(a){if(this.index+5>=this.size||this.size<6){return}this.index++;$("#pro-recommend-list").animate({left:-193*this.index},1000);$("#cart-img-prev").attr("class","pro-scroller-back");if(this.index+5==this.size){$("#cart-img-next").attr("class","pro-scroller-forward-disabled")}}};ec.shoppingCart.refreshRecover=function(){$("#pro-delete-recover").hide();var a=ec.util.cookie.get("cart-recover");if(a){a=a.split(",");var e={},c,b=[];for(var d=a.length-1;d>=0;d--){c=a[d].split(";");if(c[0].length>0){b.push(c[0]);e[c[0]]=c[1]}}if(b.length>0){$.ajax({url:domainMain+"/product/queryInfo.json?skuId="+b.join("&skuId=")+"&t="+new Date().getTime(),dataType:"jsonp",timeout:10000,success:function(j){if(!j.success){return}if(j.data!=null){var h=[],k=[],m,l;var f=ec.util.cookie.get("cart-foldingDoor");for(var g=0;g<j.data.length;g++){m=j.data[g];l=parseInt(e[m.skuId],10);if(g==0){k.push('<ul id="pro-recover-'+m.skuId+'" class="clearfix">');k.push('<li><a href="'+domainMain+"/product/"+m.prdId+".html#"+m.skuId+'" target="_blank" title="'+ec.util.escapeHtml(m.prdSkuName)+'">'+ec.util.escapeHtml(m.prdSkuName)+"</a></li>");k.push('<li class="">x'+l+"</li>");k.push("<li>&yen;&nbsp;"+l*m.price+"</li>");k.push('<li><a class="pro-delete-btn" href="javascript:;" onclick="ec.cart.readd('+m.skuId+","+l+');return false;">\u91cd\u65b0\u8d2d\u4e70</a></li></ul>')}h.push('<ul id="pro-recover-'+m.skuId+'" class="clearfix">');h.push('<li><a href="'+domainMain+"/product/"+m.prdId+".html#"+m.skuId+'" target="_blank" title="'+ec.util.escapeHtml(m.prdSkuName)+'">'+ec.util.escapeHtml(m.prdSkuName)+"</a></li>");h.push('<li class="">x'+l+"</li>");h.push("<li>&yen;&nbsp;"+l*m.price+"</li>");h.push('<li><a class="pro-delete-btn" href="javascript:;" onclick="ec.cart.readd('+m.skuId+","+l+');return false;" >\u91cd\u65b0\u8d2d\u4e70</a></li></ul>')}if(j.data.length==1){$("#pro-delete-shop-start").hide();$("#pro-delete-shop-end").hide();$("#pro-recover-tb").html(h.join(""))}else{if(!f||f=="doorClose"){$("#pro-delete-shop-start").show();$("#pro-delete-shop-end").hide();$("#pro-recover-tb").html(k.join(""))}else{if(f=="doorOpen"){$("#pro-delete-shop-start").hide();$("#pro-delete-shop-end").show();$("#pro-recover-tb").html(h.join(""))}}$("#pro-delete-shop-start").unbind("click").bind("click",function(){ec.util.cookie.set("cart-foldingDoor","doorOpen");$("#pro-delete-shop-start").hide();$("#pro-delete-shop-end").show();$("#pro-recover-tb").html(h.join(""))});$("#pro-delete-shop-end").unbind("click").bind("click",function(){ec.util.cookie.set("cart-foldingDoor","doorClose");$("#pro-delete-shop-start").show();$("#pro-delete-shop-end").hide();$("#pro-recover-tb").html(k.join(""))})}$("#pro-delete-recover").show()}}})}else{$("#pro-delete-recover").hide()}}};ec.shoppingCart.buildTotalArea=function(b){var c=[];c.push('<div id="cart-total-area" class="sc-total-tool layout clearfix ">');c.push('<div class="sc-total-control">');c.push('<label><i class="icon-choose-normal icon-choose icon-choose-all" id="checkAll-buttom"></i>\u5168\u9009</label><a href="javascript:;">\u5220\u9664</a>');c.push("</div>");c.push('<div class="sc-total-btn ">');c.push('<a href="javascript:;" seed="cart-pay">\u7acb\u5373\u7ed3\u7b97</a>');c.push('<div class="sc-action-tips hide"><div class="tips-style-1 tips-area"><i></i><div class="tips-text"><p>\u8d2d\u7269\u8f66\u4e2d\u6709\u5e93\u5b58\u4e0d\u8db3\u5546\u54c1\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97</p></div><s></s></div></div></div>');c.push('<div class="sc-total-price">');c.push('<p><label>\u603b\u8ba1\uff1a</label><span id="sc-cartInfo-totalOriginalPrice">&yen;&nbsp;'+b.miniTotalPrice.toFixed(2)+"</span><em><b>\u4e0d\u542b\u8fd0\u8d39</b></em></p>");c.push('<div class="total-choose">\u5df2\u9009\u62e9<em id="totalNumber">'+b.miniTotalNumber+'</em>\u4ef6\u5546\u54c1\uff0c\u4f18\u60e0\uff1a<span id="sc-cartInfo-minusPrice">&yen;&nbsp;'+(b.miniTotalOriginalPrice-b.miniTotalPrice).toFixed(2)+"</span></div>");c.push("</div>");$("#center_balance").html(c.join(""));var a=$("#center_balance");a.find("#sc-cartInfo-totalOriginalPrice").html("&yen;&nbsp;"+b.miniTotalPrice.toFixed(2));a.find("#sc-cartInfo-minusPrice").html("&yen;&nbsp;"+(b.miniTotalOriginalPrice-b.miniTotalPrice).toFixed(2));a.find("#sc-cartInfo-totalPrice").html("&yen;&nbsp;"+b.miniTotalPrice.toFixed(2));return a};ec.shoppingCart.checkResultData=function(b){var a=true;if(b||b.miniTotalNumber==0){if(!b.itemList||(b.itemList&&b.itemList.length==0)){$("#cart-empty-msg").show();$("#locationForEnd").remove();$("#center_balance").html("");$(".sc-total-fixed").remove();$("#cart-form").remove();a=false}}else{$("#cart-empty-msg").show();a=false}return a};ec.shoppingCart.packageDate=function(a,b){ec.shoppingCart.getGlobleParamer(b)};ec.shoppingCart.getGlobleParamer=function(a){var d=$("#globleParameter");var c=domainMain+d.attr("context");var b=d.attr("mediaPath");a.context=c;a.mediaPath=b};ec.shoppingCart.createShoppingCart=function(f,b,d){f.html(ec.shoppingCart._template.parse("product-list",d));var g=d.couponList;var a=d.premiumsList;if($("#cart-form").html()){$("#cart-form").remove()}$("#locationForEnd").remove();var c=$('<form id="cart-form" autocomplete="off" method="get"></form>').submit(ec.shoppingCart.confirm).append('<input type="hidden" name="state" value="1"/>').append(f);var e=$("div.sc-list");e.append(c).append('<div id="locationForEnd"></div>')};serviceFlage=true;ec.shoppingCart.addButtonEventandCheckbox=function(){$("#checkAll-top,#checkAll-buttom").click(function(){if(!$(".icon-choose-all").hasClass("icon-choose")){$(".icon-choose-all").addClass("icon-choose")}else{$(".icon-choose-all").removeClass("icon-choose")}ec.shoppingCart.checkAll(this)});$(".sc-total-control a").click(function(){ec.shoppingCart.del(this)});$(".sc-total-btn a").click(ec.shoppingCart.confirm);$(".mousedown").mouseenter(function(){if($(this).find("a").css("display")=="none"){return}$(this).parents(".p-service-area").addClass("p-service-open")});$(".mouse-leave-2").mouseleave(function(){$(this).parents(".p-service-area").removeClass("p-service-open");ec.shoppingCart.addServiceToCart($(this).parent().attr("mainSkuId"))});$(".mouse-leave-1").mouseleave(function(){$(this).parents(".p-service-area").removeClass("p-service-open");ec.shoppingCart.addServiceToCart($(this).parent().attr("mainSkuId"))});$(".mouse-leave-2").mouseenter(function(){$(this).parents(".p-service-area").addClass("p-service-open")});ec.shoppingCart.serviceBindEvent()};ec.shoppingCart.getErroInfo=function(c,a,b){var d={};switch(parseInt(c)){case 1:d.title="\u5931\u6548";d.tips="\u6b64\u5546\u54c1\u4e0d\u53ef\u8d2d\u4e70";return d;case 2:d.title="\u5931\u6548";d.tips="\u6b64\u5546\u54c1\u4e0d\u53ef\u8d2d\u4e70";return d;case 3:d.title="\u5931\u6548";d.tips="\u6b64\u5546\u54c1\u4e0d\u53ef\u8d2d\u4e70";return d;case 4:d.title="\u5931\u6548";d.tips="\u6b64\u5546\u54c1\u4e0d\u53ef\u8d2d\u4e70";return d;case 5:d.title="\u5931\u6548";if(b=="prefer"){d.tips="\u6b64\u5546\u54c1\u4e0d\u53ef\u8d2d\u4e70"}else{d.tips="\u6b64\u5546\u54c1\u6682\u4e0d\u53ef\u8d2d\u4e70"}return d;case 6:d.title="\u7f3a\u8d27";d.tips="\u6b64\u5546\u54c1\u6682\u65f6\u7f3a\u8d27";return d;case 7:d.title="";d.tips="\u9650\u8d2d"+a+"\u4ef6";return d;case 8:d.title="";d.tips="\u9650\u8d2d"+a+"\u4ef6";return d;default:d.title="";d.tips="";return d}};ec.shoppingCart.initErrorInfo=function(e){var f=e.itemList;for(var d=0;d<f.length;d++){var k=f[d];if(k.isBundle=="1"){for(var b=0;b<k.skuList.length;b++){var g=k.skuList[b],h=ec.shoppingCart.getErroInfo(g.invalidCauseReason,g.invalidCauseLeftValue);g.errorTips=h.tips;g.errorTitle=h.title}}else{if(k.isBundle=="0"){var h=ec.shoppingCart.getErroInfo(k.invalidCauseReason,k.invalidCauseLeftValue);f[d].errorTips=h.tips;f[d].errorTitle=h.title;if(k.giftList&&k.giftList.length>0){for(var b=0;b<k.giftList.length;b++){var c=k.giftList[b],h=ec.shoppingCart.getErroInfo(c.invalidCauseReason,c.invalidCauseLeftValue);c.errorTips=h.tips;c.errorTitle=h.title}}if(k.preferSkuList&&k.preferSkuList.length>0){for(var b=0;b<k.preferSkuList.length;b++){var a=k.preferSkuList[b],h=ec.shoppingCart.getErroInfo(a.invalidCauseReason,a.invalidCauseLeftValue,"prefer");a.errorTips=h.tips;a.errorTitle=h.title}}}}}};ec.shoppingCart.centerBalanceExists=function(c){var d=$(window);var a={top:d.scrollTop(),left:d.scrollLeft()};a.right=a.left+d.width();a.bottom=a.top+d.height();var b=$(c).offset();b.right=b.left+$(c).outerWidth();b.bottom=b.top+$(c).outerHeight();return(!(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom))};ec.shoppingCart.scrollEvent=function(){};ec.shoppingCart.getlimit=function(a,c){var b=c-a>0?(a==0?c:a):(c==0?a:c);return b};ec.shoppingCart.isSelectAll=false;ec.shoppingCart.processCheck=function(d){ec.shoppingCart.isSelectAll=false;var b=d.itemList,c=true,a=0,g=0;for(var e=0;e<b.length;e++){var f=b[e];if(f.invalidCauseReason!=0){g++}if(f.isBundle=="1"){if(f.bundleProp.selected=="1"){b[e].checked=true;if(f.invalidCauseReason==0){a++}}else{b[e].checked=false}}else{if(f.productProp.selected=="1"){b[e].checked=true;if(f.invalidCauseReason==0){a++}}else{b[e].checked=false}}}if(a!=0&&(g+a)==b.length){ec.shoppingCart.isSelectAll=true}};ec.shoppingCart.processLimit=function(h){var k=h.itemList;for(var g=0;g<k.length;g++){var o=k[g],d=[],c=[];o.limit=2;if(o.isBundle=="1"){for(var f=0;f<o.skuList.length;f++){var m=o.skuList[f],a=m.sbomLimit,l=m.productLimit;e=ec.shoppingCart.getlimit(a,l);if(e>0){d.push(m.skuId+":"+e)}if(m.quantity>e&&e>0){m.limit=0;m.tips="\u9650\u8d2d"+e+"\u4ef6";o.limit=0;c.push(m.skuId)}else{if(m.quantity==e&&e>0){m.limit=1;o.limit=1}else{m.limit=2}}}if(d.length>0){o.limitSku=d.join(",")}else{o.limitSku=""}if(c.length>0){o.alreadyLimit=c.join(",")}else{o.alreadyLimit=""}}else{if(o.isBundle=="0"){var e=ec.shoppingCart.getlimit(o.sbomLimit,o.productLimit);if(o.quantity>e&&e>0){o.limit=0;o.tips="\u9650\u8d2d"+e+"\u4ef6"}else{if(o.quantity==e&&e>0){o.limit=1}}if(o.preferSkuList&&o.preferSkuList.length>0){for(var f=0;f<o.preferSkuList.length;f++){var b=o.preferSkuList[f],n=ec.shoppingCart.getlimit(b.sbomLimit,b.productLimit);if(b.quantity>n&&n>0){b.limit=0;b.tips="\u9650\u8d2d"+e+"\u4ef6"}}}}}}};ec.shoppingCart.initCartTable=function(t){var j=t;if(!ec.shoppingCart.checkResultData(j)){ec.shoppingCart.selling.initRecommend();ec.shoppingCart.hideProductList();ec.shoppingCart.coupon.hideCoupon();return false}ec.shoppingCart.initErrorInfo(j);ec.shoppingCart.processCheck(j);ec.shoppingCart.processLimit(j);ec.shoppingCart.processService(j);var h=$('<div id="cart-list"></div>');var p=ec.shoppingCart.buildTotalArea(j);ec.shoppingCart.packageDate(t,j);ec.shoppingCart.createShoppingCart(h,p,j);$("#checkAll-top").unbind("click");ec.shoppingCart.addButtonEventandCheckbox();ec.shoppingCart.checkCheckboxIsTrue(j);ec.shoppingCart._renderNum();ec.shoppingCart.prefer.preferProductFromCart(j);ec.shoppingCart.prefer.selectSbomCodes("",true);ec.shoppingCart.recommend.selectSbomIds("",true);var f=$("#cart-total-area").offset().top;var d=$(window).height();ec.shoppingCart.updateServiceUpDownHeight();function m(){if(!$("#locationForEnd").offset()){return}l=i.offsetHeight;s=$("#locationForEnd").offset().top;var c=k.offsetTop>>0,n=b.clientHeight>>0,a=g.innerHeight||b.offsetHeight,r=b.scrollTop||e.body.scrollTop,o=g.pageYOffset?g.pageYOffset:r;i.className=o+a-l>=s?"":c>n?" sc-total-fixed ":"sc-total-fixed"}var s=0,l,g=window,e=document,b=e.documentElement,k=e.getElementById("locationForEnd"),i=e.getElementById("center_balance");function q(a,n){var c=new Date().getTime();return function(){if((c+n-new Date().getTime())<0){a();c=new Date().getTime()}}}$(window).scroll(q(m,50));m();return true};ec.shoppingCart.checkCheckboxIsTrue=function(b){var e=0;var d=$(".sc-pro-list i.icon-choose-normal");var a=d.length;for(var c=0;c<a;c++){var f=$(d[c]);if($(f).hasClass("icon-choose-disabled")){e++}}if(a==e){$(".sc-total-btn").attr("class","sc-total-btn-disabled");$(".sc-total-btn-disabled a").remove();$(".sc-total-btn-disabled").append("<span>\u7acb\u5373\u7ed3\u7b97</span>")}if(ec.shoppingCart.isSelectAll){$("#checkAll-top").attr("class","icon-choose-normal icon-choose icon-choose-all");$("#checkAll-buttom").attr("class","icon-choose-normal icon-choose icon-choose-all")}else{$("#checkAll-top").attr("class","icon-choose-normal icon-choose-all");$("#checkAll-buttom").attr("class","icon-choose-normal icon-choose-all")}};ec.shoppingCart._updateNum=function(a,d,c){ec.ui.loading.show();ec.shoppingCart._arr=[];ec.shoppingCart.selectedPrdSkuId=a;ec.shoppingCart.selectedPrdSkuIdType=d;$("#cart-list i[id^='icon-choose-'].icon-choose").each(function(){var g=this;var h={id:g.getAttribute("value"),type:g.getAttribute("data-type")};ec.shoppingCart._arr.push(h)});var b=[],e={};if(!d){return}if(d=="1"){e.itemType="S0"}if(d=="8"){e.itemType="S0";e.itemProp={Internal_Purchase:"true"}}if(d=="2"){e.itemType="B"}if(d=="9"){e.itemType="B";e.itemProp={Internal_Purchase:"true"}}e.itemId=a;e.qty=c;e.operation=4;b.push(e);var f=ec.lang.json.stringify(b);new ec.ajax().get({url:domainCart+"/newcart/update.json",dataType:"jsonp",data:{cartjson:f,saleChannel:1001,salePortal:1},timeout:10000,timeoutFunction:function(){ec.ui.loading.hide();ec.shoppingCart._faultTolerant(a,d,c);alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},errorFunction:function(){ec.ui.loading.hide();ec.shoppingCart._faultTolerant(a,d,c)},successFunction:function(i){if("0"!=i.retcode){ec.ui.loading.hide();ec.shoppingCart._faultTolerant(a,d,c);ec.showError(i);return}ec.ui.loading.hide();var h=i.cartInfo.cartVO;var j=new Array();ec.shoppingCart.refresh(h);var k=ec.shoppingCart.getlimit(parseInt($("#quantity-"+a).attr("sbomlimit")),parseInt($("#quantity-"+a).attr("productlimit")));if(k==$("#quantity-"+a).attr("value")){var g=$("#quantity-"+a).parent().parent().parent().parent().parent().parent();g.find(".p-stock-tips span").html($("#quantity-"+a).attr("value"));g.find(".p-stock-tips").show().delay(3000).hide(0)}}})};ec.shoppingCart.initCartTableAndRecommend=function(){ec.shoppingCart.mergeCart(ec.shoppingCart.getInfoFromCart)};ec.shoppingCart.getInfoFromCart=function(){$.ajax({url:domainCart+"/newcart/shoppingCart.json?t="+new Date().getTime(),dataType:"jsonp",timeout:10000,traditional:true,data:{salePortal:1,saleChannel:1001},success:function(a){if(a.retcode!="0"){$("#cart-empty-msg").show();ec.shoppingCart.selling.initRecommend();ec.shoppingCart.hideProductList();ec.shoppingCart.coupon.hideCoupon();return}if(ec.shoppingCart.initCartTable(a.cartInfo.cartVO)){ec.shoppingCart.coupon.loadCoupon();$("#pro-selling-area").hide()}},error:function(){}})};ec.shoppingCart.mergeCart=function(b,a){var d=ec.util.cookie.get("cartId");if(d&&d.length>0){var c=ec.util.cookie.get("isValCas");if(c&&"false"==c){$.ajax({url:domainMain+"/account/load",type:"POST"});c=ec.util.cookie.get("isValCas")}if(ec.account.isLogin()){ec.cart.doCache2cart(b,a)}else{$("#login-prompt-cart").show();b(a)}}else{b(a)}};ec.shoppingCart.convertCartItem=function(m){var h=[];if(m.cart&&m.cart.length>0){for(var g=0;g<m.cart.length;g++){var b=m.cart[g];var k={};k.itemId=b.skuId;k.qty=b.quantity;if(b.productType=="1"){k.itemType="S0";var a=[];if(b.giftCartList&&b.giftCartList.length>0){for(var e=0;e<b.giftCartList.length;e++){var d={sbomCode:b.giftCartList[e].skuId};a.push(d)}}k.gifts=a}if(b.productType=="8"){k.itemType="S0";k.itemProp={Internal_Purchase:"true"}}if(b.productType=="6"){k.itemType="S1";k.itemProp={main_skucode:b.mainSkuId}}if(b.productType=="7"){k.itemType="S6";k.itemProp={main_skucode:b.mainSkuId}}if(b.productType=="2"){k.itemId=b.bundleId;k.itemType="B"}if(b.productType=="9"){k.itemId=b.bundleId;k.itemType="B";k.itemProp={Internal_Purchase:"true"}}h.push(k)}}var l=ec.lang.json.stringify(h);var c=new Date();var f={};f.cartjson=l;f.t=c.getTime();return f};ec.shoppingCart.showProductList=function(){$("#shopping-cart-product-list").show()};ec.shoppingCart.hideProductList=function(){$("#shopping-cart-product-list").hide()};ec.shoppingCart.selectServicePrd=function(a){if($(a).hasClass("p-service-info-open")){$(a).removeClass("p-service-info-open");$(a).find("div").each(function(){if($(this).hasClass("disabled")&&$(this).html().indexOf("\u65e0\u9700")!=-1){$(this).addClass("hide")}});$(a).next().hide()}else{$(a).find("div").each(function(){if($(this).html().indexOf("\u65e0\u9700")!=-1){$(this).removeClass("hide")}});$(a).addClass("p-service-info-open");$(a).next().show()}};ec.shoppingCart.buildOrderItemReqArg=function(e,g){var a=[];var c={};if(g){c.mainItemid=(e).attr("maincode")}c.itemId=(e).attr("data-id");c.itemType=(e).attr("data-type");c.qty=(e).attr("data-qty");a.push(c);var f=ec.lang.json.stringify(a);var b=new Date();var d={};d.cartjson=f;d.salePortal="1";d.saleChannel="1001";d.needResultset=1;return d};ec.shoppingCart.addCartItem=function(b,c){$("#pro-recommend-list").css({transform:"translate3d(0px, 0px, 0px)"});var a=ec.shoppingCart.buildOrderItemReqArg(b,c);new ec.ajax().get({url:domainCart+"/newcart/add.json",timeout:10000,data:a,dataType:"jsonp",timeoutFunction:function(){alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){},afterSendFunction:function(){},successFunction:function(e){if(e.retcode!="0"){if(e.retcode=="TV0004"){var d=[];d.push('<div class="box-content" style="height: auto;"> ');d.push('<div class="box-prompt01-error">');d.push('    <div class="h">');d.push("        <i></i>");d.push("   </div>");d.push('   <div class="b">');d.push("\u60a8\u8d2d\u7269\u8f66\u6dfb\u52a0\u5546\u54c1\u6570\u91cf\u5df2\u8fbe\u4e0a\u9650\uff0c\u8bf7\u5148\u7ed3\u7b97\u90e8\u5206\u5546\u54c1\u54e6");d.push("  </div>");d.push("</div>");d.push(' <div class="box-button">');d.push('     <a href="javascript:;" class="box-ok"><span>\u786e\u5b9a</span></a>');d.push("</div>");d.push("</div>");new ec.box(d.join(""),{boxid:"cartNumOverFlow",boxclass:"ol_box_4",width:537,height:235,title:"",showButton:false,onopen:function(f){f.setPosition()}}).open();return false}return false}ec.shoppingCart.prefer.hideProduct(b);ec.shoppingCart.refresh(e.cartInfo.cartVO)}})};ec.shoppingCart.delCartItem=function(b,c){var c=true;var a=ec.shoppingCart.buildOrderItemReqArg(b,c);new ec.ajax().get({url:domainCart+"/newcart/del.json",timeout:10000,dataType:"jsonp",data:a,timeoutFunction:function(){alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){},afterSendFunction:function(){},successFunction:function(d){ec.cart.changeAdded(d);if(d.retcode!="0"){return}ec.shoppingCart.refresh(d.cartInfo.cartVO)}})};function resetToAccounts(){var q=0,p,g=window,e=document,b=e.documentElement,m=e.getElementById("locationForEnd"),h=e.getElementById("center_balance");p=h.offsetHeight;if(!$("#locationForEnd").offset()){return}q=$("#locationForEnd").offset().top;var j=m.offsetTop>>0,v=b.clientHeight>>0,t=g.innerHeight||b.offsetHeight,l=b.scrollTop||e.body.scrollTop,k=g.pageYOffset?g.pageYOffset:l;h.className=k+t-p>=q?"":j>v?" sc-total-fixed ":"sc-total-fixed"}globalPmsService=undefined;ec.shoppingCart.queryServiceSkuSync=function(b,a){if(b.length>0){$.ajax({url:"/product/getServiceSku.json?code="+b.join(","),timeout:5000,async:false,success:function(c){if(!c.success){return}globalPmsService=c.serviceList},error:function(){return}})}else{return}};ec.shoppingCart.mergeS=function(q,m){for(var r=0;r<m.length;r++){var b=false;var e=m[r];if(q&&q.length>0){for(var f=0;f<q.length;f++){var d=q[f];if(e.mainSbomId==d.mainSbomId){if(e.extendsSbomList.length>0&&d.extendsSbomList.length==0){for(var a=0;a<e.extendsSbomList.length;a++){e.extendsSbomList[a].usable=0;e.extendsSbomList[a].selected=1}e.noServiceNow=1}else{if(e.extendsSbomList.length==0&&d.extendsSbomList.length>0){for(var h=0;h<d.extendsSbomList.length;h++){e.extendsSbomList.push(d.extendsSbomList[h])}e.noServiceNow=0}else{var l=e.extendsSbomList,j=d.extendsSbomList;e.extendsSbomList=[];for(var o=0;o<j.length;o++){e.extendsSbomList.push(j[o])}var k=e.extendsSbomList;for(var c=0;c<l.length;c++){var g=false;for(var n=0;n<k.length;n++){if(k[n].sbomId==l[c].sbomId){k[n].selected=1;g=true}}if(!g){l[c].selected=1;l[c].usable=0;e.extendsSbomList.push(l[c])}}}}b=true;break}}}if(!b){var l=e.extendsSbomList;for(var i=0;i<l.length;i++){l[i].usable=0}e.noServiceNow=1}}return m};ec.shoppingCart.processService=function(w){var r=[],a=[],v=w.itemList,c=[];for(var z=0;z<v.length;z++){var G=v[z];G.extendS=[];G.accidentS=[];G.extendSelected={};G.accidentSelectd={};if(G.isBundle=="0"){r.push(G.sbomCode);if(G.invalidCauseReason==0){c.push(G.sbomCode)}var L={};L.mainSbomCode=G.sbomCode;L.mainSbomId=G.skuId;var E=G.extendAccidentList,K=[],b={},k={};if(E&&E.length>0){for(var y=0;y<E.length;y++){var H=E[y],I={};I.disPrdId=H.id;I.price=H.salePrice;I.sbomCode=H.sbomCode;I.sbomId=H.skuId;I.sbomName=H.prdSkuName;I.selected=1;if(H.productType==6){I.serviceType=1;b=H}else{if(H.productType==7){I.serviceType=6;k=H}}K.push(I);G.extendSelected=b;G.accidentSelectd=k}}L.extendsSbomList=K;a.push(L)}}var h;ec.shoppingCart.queryServiceSkuSync(r);if(globalPmsService){var l=ec.shoppingCart.mergeS(globalPmsService,a);globalPmsService=undefined;for(var u=0;u<v.length;u++){var G=v[u];if(G.isBundle=="0"){for(var t=0;t<l.length;t++){var L=l[t],J=[],D=[];if(G.skuId==L.mainSbomId){for(var n=0;n<L.extendsSbomList.length;n++){var m=L.extendsSbomList[n];if(m.usable!=0){if(m.serviceType==1){J.push(m)}else{if(m.serviceType==6){D.push(m)}}}}G.extendS=J;G.accidentS=D}}if(!G.extendSelected){G.extendSelected={}}if(!G.accidentSelectd){G.accidentSelectd={}}}}for(var C=0;C<v.length;C++){var G=v[C];if(G.isBundle=="0"){if(G.extendSelected.id){if(G.extendS&&G.extendS.length>0){var o=false;for(var B=0;B<G.extendS.length;B++){var s=G.extendS[B];if(s.sbomId==G.extendSelected.skuId){o=true}}if(!o){G.extendSelected.unsable=1}}else{G.extendSelected.unsable=1}}if(G.accidentSelectd.id){if(G.accidentS&&G.accidentS.length>0){var o=false;for(var A=0;A<G.accidentS.length;A++){if(G.accidentS[A].sbomId==G.accidentSelectd.skuId){o=true}}if(!o){G.accidentSelectd.unsable=1}}else{G.accidentSelectd.unsable=1}}}}}ec.shoppingCart.prefer.syncproductList(c);if(!globalPreferential){return}ec.shoppingCart.prefer.preferProductFromCart(w);for(var F=0;F<v.length;F++){var G=v[F];if(G.isBundle=="0"){$.each(globalPreferential,function(j,e){var d=e.length;for(var g=0;g<d;g++){var f=e[g].mainSBOMCode;if(G.sbomCode==e[g].mainSBOMCode){if(e[g].prefereBuyPrdList){for(var p=0;p<e[g].prefereBuyPrdList.length;p++){var q=f+"_"+e[g].prefereBuyPrdList[p].sbomId;if(preferentialMap[q]&&preferentialMap[q]!=null){e[g].prefereBuyPrdList[p].isHide="hide"}else{e[g].prefereBuyPrdList[p].isHide=""}}G.prefereBuyPrdList=e[g].prefereBuyPrdList}}}})}}};ec.shoppingCart.serviceBindEvent=function(){$(".product-service-list a").click(function(){if($(this).hasClass("selected")){return}if($(this).parent().parent().parent().hasClass("extend-service")){var d=$(this).attr("pid"),a=$(this).attr("name"),h=$(this).attr("maincode"),e=$(this).attr("price"),k=$(this).attr("mainSkuId"),j=$(this).attr("skuid"),f=$(this).attr("sbomCode");var b=$(this).parent().parent().next().find("a");if(d!=-1){b.show();b.attr("id",d);b.attr("href",domainMain+"/product/"+d+".html");$("#extendSelect-"+k).attr("newvalue",j);$("#extend-"+k).attr("skuid",j);$("#extend-"+k).attr("data-scode",f)}else{$("#extend-"+k).attr("skuid","");$("#extend-"+k).attr("data-scode","");b.hide();a="";$("#extendSelect-"+k).attr("newvalue","-1")}if($("#extendSelect-a-"+k).hasClass("disabled-no")){$("#extendSelect-a-"+k).removeClass("disabled-no");$("#extendSelect-a-"+k).parent().next().html("");$("#extendSelect-"+k).removeClass("disabled");$("#extend-del-"+k).html("");$("#extend-del-"+k).attr("onclick","")}if(a.length==0){if($("#accidentSelect-a-"+k).parent().parent().parent().hasClass("hide")){if($("#extendSelect-"+k).attr("noextend")!="0"){$("#extendSelect-a-"+k).html("<i>\u5ef6\u4fdd</i>\u53ef\u9009\u5ef6\u4fdd");$("#extendSelect-a-"+k).addClass("disabled");$("#extendSelect-b-"+k).html("<i>\u5ef6\u4fdd</i>\u53ef\u9009\u5ef6\u4fdd");$("#extendSelect-b-"+k).addClass("disabled");$("#extend-price-"+k).html("");$("#extend-quantity-"+k).html("");$("#extend-totalprice-"+k).html("");$("#extendSelect-a-"+k).parent().parent().parent().removeClass("hide")}if($("#accidentSelect-"+k).attr("noaccident")!="0"){$("#accidentSelect-a-"+k).html("<i>\u788e\u5c4f\u4fdd</i>\u53ef\u9009\u788e\u5c4f\u4fdd");$("#accidentSelect-a-"+k).addClass("disabled");$("#accidentSelect-a-"+k).parent().parent().parent().removeClass("hide");$("#accidentSelect-b-"+k).html("<i>\u788e\u5c4f\u4fdd</i>\u53ef\u9009\u788e\u5c4f\u4fdd");$("#accidentSelect-b-"+k).addClass("disabled");$("#accident-price-"+k).html("");$("#accident-quantity-"+k).html("");$("#accident-totalprice-"+k).html("")}}else{$("#extendSelect-a-"+k).html("<i>\u5ef6\u4fdd</i>\u65e0\u9700\u5ef6\u4fdd");$("#extendSelect-a-"+k).addClass("disabled");$("#extendSelect-a-"+k).parent().parent().parent().addClass("hide");$("#extendSelect-b-"+k).html("<i>\u5ef6\u4fdd</i>\u65e0\u9700\u5ef6\u4fdd");$("#extendSelect-b-"+k).addClass("disabled");$("#extend-price-"+k).html("");$("#extend-quantity-"+k).html("");$("#extend-totalprice-"+k).html("")}}else{if($("#accidentSelect-a-"+k).hasClass("disabled")){$("#accidentSelect-a-"+k).parent().parent().parent().addClass("hide");$("#accidentSelect-b-"+k).html("<i>\u788e\u5c4f\u4fdd</i>\u65e0\u9700\u788e\u5c4f\u4fdd");$("#accidentSelect-b-"+k).addClass("disabled")}$("#extendSelect-a-"+k).html("<i>\u5ef6\u4fdd</i>"+a);$("#extendSelect-a-"+k).removeClass("disabled");$("#extendSelect-a-"+k).parent().parent().parent().removeClass("hide");$("#extendSelect-b-"+k).html("<i>\u5ef6\u4fdd</i>"+a);$("#extendSelect-b-"+k).removeClass("disabled");$("#extend-price-"+k).html("&yen;&nbsp;"+parseFloat(e).toFixed(2));$("#extend-quantity-"+k).html("x"+$("#quantity-"+k).attr("value"));$("#extend-totalprice-"+k).html("&yen;&nbsp;"+parseFloat(parseInt($("#quantity-"+k).attr("value"))*parseFloat(e).toFixed(2)).toFixed(2));$("#extend-"+h).attr("skuid",h)}var g=$(this).parent();g.addClass("selected");$(this).parent().siblings("li").not(g).removeClass("selected")}if($(this).parent().parent().parent().hasClass("accident-service")){var d=$(this).attr("pid"),a=$(this).attr("name"),h=$(this).attr("maincode"),e=$(this).attr("price"),k=$(this).attr("mainSkuId"),j=$(this).attr("skuid"),f=$(this).attr("sbomCode");var c=$(this).parent().parent().next().find("a");if(d!=-1){c.show();c.attr("id",d);c.attr("href",domainMain+"/product/"+d+".html");$("#accidentSelect-"+k).attr("newvalue",j);$("#accident-"+k).attr("skuid",j);$("#accident-"+k).attr("data-scode",f)}else{c.hide();a="";$("#accidentSelect-"+k).attr("newvalue","-1");$("#accident-"+k).attr("skuid","");$("#accident-"+k).attr("data-scode","")}if($("#accidentSelect-a-"+k).hasClass("disabled-no")){$("#accidentSelect-a-"+k).removeClass("disabled-no");$("#accidentSelect-a-"+k).parent().next().html("");$("#accidentSelect-"+k).removeClass("disabled");$("#accident-del-"+k).html("");$("#accident-del-"+k).attr("onclick","")}if(a.length==0){if($("#extendSelect-a-"+k).parent().parent().parent().hasClass("hide")){if($("#extendSelect-"+k).attr("noextend")!="0"){$("#extendSelect-a-"+k).html("<i>\u5ef6\u4fdd</i>\u53ef\u9009\u5ef6\u4fdd");$("#extendSelect-a-"+k).addClass("disabled");$("#extendSelect-b-"+k).html("<i>\u5ef6\u4fdd</i>\u53ef\u9009\u5ef6\u4fdd");$("#extendSelect-b-"+k).addClass("disabled");$("#extend-price-"+k).html("");$("#extend-quantity-"+k).html("");$("#extend-totalprice-"+k).html("");$("#extendSelect-a-"+k).parent().parent().parent().removeClass("hide")}if($("#accidentSelect-"+k).attr("noaccident")!="0"){$("#accidentSelect-a-"+k).html("<i>\u788e\u5c4f\u4fdd</i>\u53ef\u9009\u788e\u5c4f\u4fdd");$("#accidentSelect-a-"+k).addClass("disabled");$("#accidentSelect-a-"+k).parent().parent().parent().removeClass("hide");$("#accidentSelect-b-"+k).html("<i>\u788e\u5c4f\u4fdd</i>\u53ef\u9009\u788e\u5c4f\u4fdd");$("#accidentSelect-b-"+k).addClass("disabled");$("#accident-price-"+k).html("");$("#accident-quantity-"+k).html("");$("#accident-totalprice-"+k).html("")}}else{$("#accidentSelect-a-"+k).html("<i>\u788e\u5c4f\u4fdd</i>\u65e0\u9700\u788e\u5c4f\u4fdd");$("#accidentSelect-a-"+k).addClass("disabled");$("#accidentSelect-a-"+k).parent().parent().parent().addClass("hide");$("#accidentSelect-b-"+k).html("<i>\u788e\u5c4f\u4fdd</i>\u65e0\u9700\u788e\u5c4f\u4fdd");$("#accidentSelect-b-"+k).addClass("disabled");$("#accident-price-"+k).html("");$("#accident-quantity-"+k).html("");$("#accident-totalprice-"+k).html("")}}else{if($("#extendSelect-a-"+k).hasClass("disabled")){$("#extendSelect-a-"+k).parent().parent().parent().addClass("hide");$("#extendSelect-b-"+k).html("<i>\u5ef6\u4fdd</i>\u65e0\u9700\u5ef6\u4fdd");$("#extendSelect-b-"+k).addClass("disabled")}$("#accidentSelect-a-"+k).html("<i>\u788e\u5c4f\u4fdd</i>"+a);$("#accidentSelect-a-"+k).removeClass("disabled");$("#accidentSelect-a-"+k).parent().parent().parent().removeClass("hide");$("#accidentSelect-b-"+k).html("<i>\u788e\u5c4f\u4fdd</i>"+a);$("#accidentSelect-b-"+k).removeClass("disabled");$("#accident-price-"+k).html("&yen;&nbsp;"+parseFloat(e).toFixed(2));$("#accident-quantity-"+k).html("x"+$("#quantity-"+k).attr("value"));$("#accident-totalprice-"+k).html("&yen;&nbsp;"+parseFloat(parseInt($("#quantity-"+k).attr("value"))*parseFloat(e).toFixed(2)).toFixed(2))}var i=$(this).parent();i.addClass("selected");$(this).parent().siblings("li").not(i).removeClass("selected")}})};ec.shoppingCart.addServiceToCart=function(f){acoldvalue=$("#accidentSelect-"+f).attr("oldvalue");acnewvalue=$("#accidentSelect-"+f).attr("newvalue");exoldvalue=$("#extendSelect-"+f).attr("oldvalue");exnewvalue=$("#extendSelect-"+f).attr("newvalue");if(acoldvalue==acnewvalue&&exoldvalue==exnewvalue){return}var a={},h={},b=[];if(acoldvalue!=acnewvalue){if(acnewvalue=="-1"){var d={};d.mainItemid=f;d.itemId=acoldvalue;d.itemType="S6";d.qty=1;d.operation=3;b.push(d)}if(acnewvalue!="-1"){var d={};d.mainItemid=f;d.itemId=acnewvalue;d.itemType="S6";d.qty=1;d.operation=1;b.push(d)}}if(exoldvalue!=exnewvalue){if(exoldvalue!="-1"){var d={};d.mainItemid=f;d.itemId=exoldvalue;d.itemType="S1";d.qty=1;d.operation=3;b.push(d)}if(exnewvalue!="-1"){var d={};d.mainItemid=f;d.itemId=exnewvalue;d.itemType="S1";d.qty=1;d.operation=1;b.push(d)}}var g=ec.lang.json.stringify(b);var c=new Date();var e={};e.cartjson=g;e.salePortal="1";e.saleChannel="1001";e.needResultset=1;new ec.ajax().get({url:domainCart+"/newcart/update.json",timeout:5000,data:e,dataType:"jsonp",timeoutFunction:function(){alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},beforeSendFunction:function(){},afterSendFunction:function(){},successFunction:function(m){if(m.retcode!="0"){if(m.retcode=="TV0004"){var j=b.length;for(var l=0;l<j;l++){var n=b[l];if(n.itemType=="S1"){$("#cart-service-"+n.mainItemid).find(".extend-service a:first").click()}if(n.itemType=="S6"){$("#cart-service-"+n.mainItemid).find(".accident-service a:first").click()}}var k=[];k.push('<div class="box-content" style="height: auto;"> ');k.push('<div class="box-prompt01-error">');k.push('    <div class="h">');k.push("        <i></i>");k.push("   </div>");k.push('   <div class="b">');k.push("\u60a8\u8d2d\u7269\u8f66\u6dfb\u52a0\u5546\u54c1\u6570\u91cf\u5df2\u8fbe\u4e0a\u9650\uff0c\u8bf7\u5148\u7ed3\u7b97\u90e8\u5206\u5546\u54c1\u54e6");k.push("  </div>");k.push("</div>");k.push(' <div class="box-button">');k.push('     <a href="javascript:;" class="box-ok"><span>\u786e\u5b9a</span></a>');k.push("</div>");k.push("</div>");new ec.box(k.join(""),{boxid:"cartNumOverFlow",boxclass:"ol_box_4",width:537,height:235,title:"",showButton:false,onopen:function(i){i.setPosition()}}).open();return false}return false}$("#accidentSelect-"+f).attr("oldvalue",acnewvalue);$("#extendSelect-"+f).attr("oldvalue",exnewvalue);ec.shoppingCart.refresh(m.cartInfo.cartVO)}})};ec.shoppingCart.delService=function(d,g,a){if(!(d==1||d==6)){return}var e={},b=[];e.mainItemid=g;e.itemId=a;e.itemType="S"+d;e.qty=1;e.operation=3;b.push(e);var h=ec.lang.json.stringify(b);var c=new Date();var f={};f.cartjson=h;f.salePortal="1";f.saleChannel="1001";f.needResultset=1;new ec.ajax().get({url:domainCart+"/newcart/update.json",timeout:5000,data:f,dataType:"jsonp",timeoutFunction:function(){alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},successFunction:function(i){if(i.retcode!="0"){return false}ec.shoppingCart.refresh(i.cartInfo.cartVO)}})};ec.ready(function(){if(!ec.account.isLogin()){var d=$("#login-prompt-cart").attr("value");var c=[];c.push("\u60a8\u8fd8\u6ca1\u6709\u767b\u5f55\uff01\u767b\u5f55\u540e\u53ef\u67e5\u770b\u4e4b\u524d\u52a0\u5165\u7684\u5546\u54c1");if($.trim(d)!=""){c.push('<a id="top-index-loginUrl" href="'+d+encodeURIComponent(encodeURIComponent(window.location.href))+'" rel="nofollow">\u767b\u5f55</a>')}else{c.push('<a href="${domainMain}${context}/account/login?url='+encodeURIComponent(window.location.href)+'" rel="nofollow">\u767b\u5f55</a>')}$("#login-prompt-cart").empty().html(c.join(""))}ec.shoppingCart._template=new ec.template($("#product-list-html").val());ec.shoppingCart.initCartTableAndRecommend();ec.shoppingCart.refreshRecover();var b=getUrlParaMap4CartBinding();var a=b.isSuccess;if(null!=a&&"0"==a){bindCartResult("ec-binding-phone")}});ec.shoppingCart.updateServiceUpDownHeight=function(){$(".extend-service").each(function(){var a=$(this).find("ul li").length,b=Math.ceil((a-1)/2);liHeight=$(this).find("ul li").height();$(this).find("ul li").eq(0).css({height:(b*24)-6})});$(".accident-service").each(function(){var a=$(this).find("ul li").length,b=Math.ceil((a-1)/2);liHeight=$(this).find("ul li").height();$(this).find("ul li").eq(0).css({height:(b*24)-6})})};ec.shoppingCart.limitTip=function(a,b){a.each(function(){a.click(function(d){var c=$(this).parent().parent().parent().parent().parent().parent();c.find(".p-stock-tips span").html(b);c.find(".p-stock-tips").show().delay(3000).hide(0)})})};
