ec.pkg("deposit");ec.product.depositInfo={};ec.product.depositInit=function(a){if(ec.product.runningSkuId!=a){return}ec.product.depositInfo={};if($("#product-deposit-agreement-area")){$("#product-deposit-agreement-area").hide()}$("#pro-quantity-area").hide();$("#pro-quantity-area-nochange").hide();$("#pro-operation").css("visibility","hidden");$("#pro-price-label").html("\u6682\u65e0\u62a5\u4ef7");$("#pro-price-label").show();$("#pro-price").html("");$("#pro-price-old").html("");$("#pro-price").hide();$("#pro-price-old").hide();$("#pro-operation").css("visibility","hidden");$("#tab-notice-button").hide();$("#tab-addcart-button").hide()};ec.product.isDespositSku=0;ec.product.runningSkuId=0;ec.product.depositActivity=function(a){var b=ec.product.getSkuInfo(a);if($("#product-deposit-agreement-area")){$("#product-deposit-agreement-area").hide()}$("#pro-operation").css("visibility","hidden");ec.product.isDespositSku=0;ec.product.runningSkuId=a;new ec.ajax().get({url:"/product/queryDeposit.json",data:{skuId:a},timeout:10000,timeoutFunction:function(){if(ec.product.runningSkuId!=a){return}ec.product.isDespositSku=2;if(b&&b.buttonMode==8){ec.product.rushbuyActivity()}else{ec.product.depositInit(a);alert("\u67e5\u8be2\u9884\u4ed8\u5b9a\u91d1\u6d3b\u52a8\u4fe1\u606f\u8d85\u65f6\uff0c\u8bf7\u91cd\u65b0\u5237\u65b0\u9875\u9762\u3002")}},beforeSendFunction:ec.ui.loading.show,afterSendFunction:ec.ui.loading.hide,successFunction:function(c){if(ec.product.runningSkuId!=a){return}if(!c||!c.success){ec.product.isDespositSku=2;if(b&&b.buttonMode==8){ec.product.rushbuyActivity()}else{ec.product.depositInit(a)}return}ec.product.isDespositSku=1;ec.product.depositInit(a);if(c.notBegin==true){$("#pro-operation").html('<a href="javascript:;" class="product-button02 disabled">\u6d3b\u52a8\u5373\u5c06\u5f00\u59cb</a>');$("#pro-operation").css("visibility","visible");$("#product-operation").show();ec.product.refreshStyle();return}if(c.end==true){$("#pro-operation").html('<a href="javascript:;" class="product-button02 disabled">\u6d3b\u52a8\u5df2\u7ed3\u675f</a>');$("#pro-operation").css("visibility","visible");$("#product-operation").show();ec.product.refreshStyle();return}ec.product.depositInfo=c;if(c.promoActivity.description.length>0){if($("#pro-parts-area").length>0){$("#pro-parts-area").find("dt").text("")}}$("#pro-price-label").html("\u8ba2\u91d1\u4ef7\u683c");$("#pro-price-label").show();$("#pro-price").html("&yen;&nbsp;"+c.promoDepositSku.depositPrice.toFixed(2));$("#pro-price").show();$("#pro-price-old").html("");$("#pro-price-old").hide();$("#product-deposit-agreement-area").show();if(ec.product.inventory.haveInventory(a)){$("#pro-operation").html('<a href="javascript:;" class="product-button02" onclick="ec.product.payDeposit(1);">\u652f\u4ed8\u8ba2\u91d1</a>');$("#pro-quantity-area").show();$("#pro-operation").css("visibility","visible");$("#product-operation").show()}else{$("#pro-operation").html('<a href="javascript:;" class="product-button02" onclick="ec.product.arrival()">\u5230\u8d27\u901a\u77e5</a>');$("#pro-quantity-area").show();$("#pro-operation").css("visibility","visible");$("#product-operation").show()}ec.product.refreshStyle()}})};ec.product.showDepositAgreement=function(){var a='<div class="box-agreement-area">'+ec.product.depositInfo.promoActivity.ruleText+"</div>";new ec.box(a,{boxclass:"ol_box_4 ol_box_agreement",title:"\u8ba2\u91d1\u652f\u4ed8\u534f\u8bae",width:678,height:350,autoHeight:false}).open()};ec.product.payDeposit=function(a){if(!$("#pro-agreement-area-check").attr("checked")){var b='<div class="box-prompt-error-area"><div class="b"><p>\u60a8\u5fc5\u987b\u5148\u52fe\u9009\u540c\u610f\u8ba2\u91d1\u652f\u4ed8\u534f\u8bae\uff0c\u624d\u53ef\u4ee5\u8fdb\u884c\u8ba2\u91d1\u652f\u4ed8\u3002</p></div></div>';new ec.box(b,{boxclass:"ol_box_4",title:"\u6e29\u99a8\u63d0\u793a",showCancel:false}).open();return}ec.account.afterLogin(function(){ec.binding.cart.withPhone(function(){dealDepositInfo(a)})})};dealDepositInfo=function(b){var c=$("#pro-quantity").val();var a=ec.product.getSku()||ec.product.defaultSku;new ec.ajax().get({url:"/product/queryQualification.json",data:{skuId:a,quantity:c},timeout:10000,timeoutFunction:function(){alert("\u67e5\u8be2\u7528\u6237\u53c2\u4e0e\u8ba2\u91d1\u6d3b\u52a8\u7684\u4fe1\u606f\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\u3002")},beforeSendFunction:ec.ui.loading.show,afterSendFunction:ec.ui.loading.hide,successFunction:function(o){if(!o.success){var j="";if(o.sessionTimeout){j='<div class="box-prompt-error-area"><div class="b"><p>'+$("<div/>").text(o.msg).html()+"</p></div></div>";new ec.box(j,{boxclass:"ol_box_4",title:"\u6e29\u99a8\u63d0\u793a",showCancel:false,onok:function(s){var r=domainMain+"/account/login?url="+encodeURIComponent(window.location.pathname);window.location.href=r}}).open()}else{j='<div class="box-prompt-error-area"><div class="b"><p>'+$("<div/>").text(o.msg).html()+"</p></div></div>";new ec.box(j,{boxclass:"ol_box_4",title:"\u6e29\u99a8\u63d0\u793a",showCancel:false}).open()}return}var h=[];var k={};k.itemId=$("#pro-sku-code").val();k.qty=$("#pro-quantity").val();k.itemType="S0";h.push(k);var e=ec.product.gift.finalMainSbomGiftMap[ec.product.getSku()];if(e&&b==1){var d=[];for(var n in e){var f={sbomCode:e[n].giftSkuCode};d.push(f)}k.gifts=d}if(b==2){$('[id="comb-pro-'+a+'"]').find("input[name=skuId]:checked").each(function(){var r={};r.itemId=$(this).attr("data-scode");r.qty=1;r.itemType="S0";h.push(r)})}var q=$("#extendSelect").attr("data-scode");var g=$("#accidentSelect").attr("data-scode");var m={};var i={};if(q.length>0){m.itemId=q;m.qty=$("#pro-quantity").val();m.itemType="S1";m.itemProp={main_skucode:$("#pro-sku-code").val()};h.push(m);if(g.length>0){i.itemId=g;i.qty=$("#pro-quantity").val();i.itemType="S6";i.itemProp={main_skucode:$("#pro-sku-code").val()};h.push(i)}}else{if(g.length>0){i.itemId=g;i.qty=$("#pro-quantity").val();i.itemType="S6";i.itemProp={main_skucode:$("#pro-sku-code").val()};h.push(i)}}var p=ec.lang.json.stringify(h);var l="";l+='<input name="orderReqJson" type="text" value=\''+p+"'>";l+='<input name="state" type="text" value="0">';$("#order-confirm-deposit-form").html(l).submit()}})};
