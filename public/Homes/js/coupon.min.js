ec.pkg("ec.product.coupon");ec.product.coupon={sbomCouponList:{},applyResultList:{},loadCoupon:function(A){$("#couponBtn").html("");ec.product.coupon.loadCouponEx(A,function(B){if(B&&B.success&&B.couponList&&B.couponList.length>0){ec.product.coupon.sbomCouponList[A]=B.couponList;$("#couponBtn").html('<a href="javascript:;" onclick="ec.product.coupon.clickBtn(\''+A+'\')" class="product-price-btn" > </a>')}else{}},function(B){},function(){})},loadCouponEx:function(C,D,B,A){new ec.ajax().get({url:"/product/queryCoupon.json?sbom="+C,type:"get",timeout:10000,timeoutFunction:function(){A()},successFunction:function(E){D(E)},errorFunction:function(E){B(E)}})},clickBtn:function(A){ec.product.coupon.showDialog(A)},closeDialog:function(){$("#pro-roll-page").hide()},showDialog:function(B){$("#pro-roll-message").html("");$("#pro-roll-list").html("");$("#pro-roll-page").hide();var A=ec.product.coupon.sbomCouponList[B];if(A){ec.product.coupon.showDialogEx(B,A)}else{ec.product.coupon.loadCouponEx(B,function(C){if(C&&C.success&&C.couponList&&C.couponList.length>0){ec.product.coupon.sbomCouponList[B]=C.couponList;ec.product.coupon.showDialogEx(B,C.couponList)}else{}},function(){},function(){})}},showDialogEx:function(E,D){var A=[];for(var B=0;B<D.length;B++){paramsReceiveCoupon="'"+D[B].activityCode+"','"+D[B].batchCode+"','"+E+"'";var C=D[B].activityCode+"-"+D[B].batchCode;var F="";switch(D[B].state){case -1:A.push('<li id="roll-detail-'+C+'" class="roll-detail receive" title="'+D[B].batchName+'">');A.push(' <a id="roll-link-'+C+'" href="javascript:;" > <em>¥</em>');F="已<br>领<br>完";break;case 1:A.push('<li id="roll-detail-'+C+'" class="roll-detail" title="'+D[B].batchName+'">');A.push(' <a id="roll-link-'+C+'" href="javascript:;"  onclick="ec.product.coupon.receiveCoupon('+paramsReceiveCoupon+')"> <em>¥</em>');F="立<br>即<br>领<br>取";break;case 2:A.push('<li id="roll-detail-'+C+'" class="roll-detail receive" title="'+D[B].batchName+'">');A.push(' <a id="roll-link-'+C+'" href="javascript:;" > <em>¥</em>');F="已<br>领<br>取";break;case 3:A.push('<li id="roll-detail-'+C+'" class="roll-detail begin" title="'+D[B].batchName+'">');A.push(' <a id="roll-link-'+C+'" href="javascript:;" > <em>¥</em>');F="即<br>将<br>开<br>始";break;case 4:A.push('<li id="roll-detail-'+C+'" class="roll-detail disabled" title="'+D[B].batchName+'">');A.push(' <a id="roll-link-'+C+'" href="javascript:;" > <em>¥</em>');F="已<br>结<br>束";break;default:A.push('<li id="roll-detail-'+C+'" class="roll-detail" title="'+D[B].batchName+'">');A.push(' <a id="roll-link-'+C+'" href="javascript:;" > <em>¥</em>');F="";break}A.push(' <div class="roll-info">');A.push('  <div class="roll-price clearfix">');A.push("    <span>"+D[B].amount+"</span>");A.push("    <p><strong>优惠券</strong></p>");A.push("  </div>");A.push(' <p class="roll-word">'+D[B].batchName+"</p>");A.push(' <p class="roll-time">'+new Date(D[B].beginDate).format("yyyy-MM-dd")+" 至 "+new Date(D[B].endDate).format("yyyy-MM-dd")+"</p>");A.push("</div>");A.push('<div id="roll-state-'+C+'" class="roll-btn">'+F+"</div>");A.push("</a></li>")}var A='<ul class="clearfix">'+A.join(" ")+"</ul>";$("#pro-roll-list").html(A);$("#pro-roll-page").show()},goLogin:function(){var A=domainMain+"/account/login?url="+encodeURIComponent(window.location.pathname+"#"+ec.product.getSku())+"&_t="+new Date().getTime();window.location.href=A},showMsg:function(C,B){B=""+B;var A="";A="<span>"+C+"</span>";switch(B){case"9206":A+='<a href="javascript:;" onclick="ec.product.coupon.goLogin()" >马上登录</a>';break;case"9208":A+='<a href="'+$("#accountCenterUrl").val()+'" target="_blank" >去绑定</a>';break;case"9209":A+='<a href="'+$("#authUrl").val()+'" target="_blank" >去认证</a>';break;case"9210":A+='<a href="'+$("#notFinishAllUPDataURL").val()+'" target="_blank" >完善资料</a>';break;default:A+=""}$("#pro-roll-message").html(A);$("#pro-roll-message").addClass("product-layer-tips")},receiveCoupon:function(A,C,D){var B=A+"-"+C;ec.product.syncCustomSession();$("#pro-roll-message").html("");$("#pro-roll-message").removeClass();$.ajax({url:domainAms+"/couponCodeActivity/receive.json?activityCode="+A+"&batchCode="+C+"&t="+new Date().getTime(),dataType:"jsonp",timeout:10000,success:function(E){if(E&&E.state){switch(E.state){case -1:$("#roll-detail-"+B).addClass("receive");$("#roll-state-"+B).html("已<br>领<br>完");$("#roll-link-"+B).removeAttr("onclick");break;case 1:break;case 2:$("#roll-detail-"+B).addClass("receive");$("#roll-state-"+B).html("已<br>领<br>取");$("#roll-link-"+B).removeAttr("onclick");break;case 3:$("#roll-detail-"+B).addClass("begin");$("#roll-state-"+B).html("即<br>将<br>开<br>始");$("#roll-link-"+B).removeAttr("onclick");break;case 4:$("#roll-detail-"+B).addClass("disabled");$("#roll-state-"+B).html("已<br>结<br>束");$("#roll-link-"+B).removeAttr("onclick");break;default:break}}if(E&&E.success){$("#pro-roll-message").html("<span>"+E.pcReviceSuccTip+"</span>");$("#pro-roll-message").addClass("product-layer-tips product-layer-success");delete ec.product.coupon.sbomCouponList[D];return}if(!E.code){$("#pro-roll-message").addClass("product-layer-tips");$("#pro-roll-message").html("<span>亲，瞬间被你的热情吓到了，容我缓缓，请稍候再来哦~</span>");return}ec.product.coupon.showMsg(E.errorTip,E.code)},error:function(){$("#pro-roll-message").addClass("product-layer-tips");$("#pro-roll-message").html("<span>亲，瞬间被你的热情吓到了，容我缓缓，请稍候再来哦~</span>")}})}};